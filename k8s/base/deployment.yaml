apiVersion: apps/v1
kind: Deployment
metadata:
  name: deploy
spec:
  selector:
    matchLabels: {}

  template:
    spec:
      serviceAccountName: sa
      containers:
        - name: server
          image: "image:0.0.0"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          volumeMounts:
            - name: my-api-token
              mountPath: /mnt/api-token
              readOnly: true

          resources:
            limits:
              cpu: 100m
              memory: 128Mi
            requests:
              cpu: 100m
              memory: 128Mi

          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          # env:
          # - name: API_TOKEN
          #   valueFrom:
          #     secretKeyRef:
          #       name: api-token
          #       key: SECRET_TOKEN

      volumes:
      - name: my-api-token
        csi:
          driver: secrets-store.csi.k8s.io
          readOnly: true
          volumeAttributes:
            secretProviderClass: aws-secrets